
<!DOCTYPE html>
<html lang="null">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="MarsBlog">
    <title>Wireshark Package Analysis - MarsBlog</title>
    <meta name="author" content="Mars Huang">
    
    
    <meta name="description" content="###server.pemtraffic.pcapng
###Wireshark 是一個 open source 的封包分析軟體 (前身為 Ethereal)，在 Linux, Windows, MacOS 都可使用，支援幾乎所有軟體擷取的網路封包檔案 (e.g.: pcap, pcappng)
###Wireshark 下載點
###linux 中若非安裝 desktop 版本則可透過 tcpd">
<meta property="og:type" content="blog">
<meta property="og:title" content="Wireshark Package Analysis">
<meta property="og:url" content="/2015/11/29/Wireshark-Package-Analysis/index.html">
<meta property="og:site_name" content="MarsBlog">
<meta property="og:description" content="###server.pemtraffic.pcapng
###Wireshark 是一個 open source 的封包分析軟體 (前身為 Ethereal)，在 Linux, Windows, MacOS 都可使用，支援幾乎所有軟體擷取的網路封包檔案 (e.g.: pcap, pcappng)
###Wireshark 下載點
###linux 中若非安裝 desktop 版本則可透過 tcpd">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTeNHprb1BOblY5UTA">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTeZTl0X1lfUzdVUlE">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTeZm1mN3lFYzc0Q3M">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTeeGcwaEJGTE1aTU0">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTeUE9zQlNPRktOQnM">
<meta property="og:image" content="https://googledrive.com/host/0BzGd3Qn1ZnTedkgyNHZGcW9odW8">
<meta property="og:updated_time" content="2015-11-28T18:42:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wireshark Package Analysis">
<meta name="twitter:description" content="###server.pemtraffic.pcapng
###Wireshark 是一個 open source 的封包分析軟體 (前身為 Ethereal)，在 Linux, Windows, MacOS 都可使用，支援幾乎所有軟體擷取的網路封包檔案 (e.g.: pcap, pcappng)
###Wireshark 下載點
###linux 中若非安裝 desktop 版本則可透過 tcpd">
    
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">MarsBlog</a>
    </h1>
    
</header>
            <nav id="sidebar" data-behavior="4">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Início</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categorias</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Arquivo</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link st-search-show-outputs"
                         href="/#search"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Pesquisar</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">Sobre</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Wireshark Package Analysis
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Sun Nov 29 2015 00:42:44 GMT+0800">
	
		    29/11/2015
    	
    </time>
    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p>###<a href="https://drive.google.com/open?id=0BzGd3Qn1ZnTeZjZiOE43RG5WUjg" target="_blank" rel="external">server.pem</a><br><a href="https://drive.google.com/open?id=0BzGd3Qn1ZnTeZk1lZ0QyX1pCWGM" target="_blank" rel="external">traffic.pcapng</a></p>
<p>###Wireshark 是一個 open source 的封包分析軟體 (前身為 Ethereal)，在 Linux, Windows, MacOS 都可使用，支援幾乎所有軟體擷取的網路封包檔案 (e.g.: pcap, pcappng)</p>
<p>###<a href="https://www.wireshark.org/download.html" target="_blank" rel="external">Wireshark 下載點</a></p>
<p>###linux 中若非安裝 desktop 版本則可透過 tcpdump 來錄製目前網路封包，再將封包送至 wireshark 解析即可</p>
<p>###可用 scp 傳送指令 linux 資料 (ssh base)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -P &#34;portNumber&#34; &#34;localFileName&#34; &#34;account&#34;@ip:/path/&#34;NewFileName&#34;&#10;// &#24478;&#26412;&#22320;&#36865;&#33267;&#36960;&#31471;&#26576;&#20491; ip: port&#10;// localFileName &#21644; &#36960;&#31471;&#36899;&#32218; &#23565;&#35519;&#21363;&#21487;&#25343;&#21462;&#36960;&#31471;&#36039;&#26009;</span><br></pre></td></tr></table></figure></p>
<p>###網路中的封包最常見的為 http 及 https 封包，https 即為 加上了 SSL/TSL 加密後的協定，因此從 wireshark 上是無法直接看到內容的，除非有 SSL 加密中的 private key (e.g.: der or pem 格式檔案)才可以解開 https 封包，首先將封包檔案匯入 wireshark 之後看到下圖:</p>
<p><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTeNHprb1BOblY5UTA"></p>
<p>###發現裡面有 TSL 字樣的封包，看起來應該是經過 SSL 加密的 https 封包，也可以透過上面的輸入列過濾只有 http 的封包，若是過濾結果為空則確定有封包經過加密</p>
<p>###可以透過 .pem 檔案將該封包解密，透過 preferences -&gt; Protocol -&gt; SSL 中的 Edit 按鍵加入 key (.pem)<br><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTeZTl0X1lfUzdVUlE"></p>
<p>###觀察被加密的封包的來源等等資料，這裡的意思是將 source/destination ip = 192.168.112.1 中的 https (443 port) 封包利用後面路徑的 key 解密成 http 封包<br><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTeZm1mN3lFYzc0Q3M"></p>
<p>###如此便能透過過濾 http 來得到解密後的封包<br><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTeeGcwaEJGTE1aTU0"></p>
<p>###看來封包為 192.168.112.1 及 192.168.112.131 兩個 ip 之間的交流，透過 get 方法傳送資料，然後接收者回傳 200 ok，查看封包內容發現接收方封包內只包含了一個 byte 的資訊，頗為不合常理，因此再次過濾<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http &#38;&#38; ip.src == 192.168.112.1</span><br></pre></td></tr></table></figure></p>
<p>###發現所有封包都只有一個 byte，推測應該可以組合成一個完整檔案，因此透過 File -&gt; Export Objects -&gt; HTTP 匯出所有 http 的封包 (要生成一個資料夾來裝匯出檔案，放在桌面會因為檔案數量太多顯示悲劇)，匯出後發現共有編號 0~6711 個各別為 1 byte 的檔案，可利用 hexedit 軟體觀看一下檔案內容，以 ubuntu 14.04 為例安裝<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update&#10;sudo apt-get install nodejs npm nodejs-legacy&#10;sudo npm install hexedit -g&#10;&#10;sudo hexedit 0&#10;// &#36879;&#36942; hexedit &#35264;&#23519; 0 &#27284;&#26696;&#30340; 16 &#36914;&#20301;&#21450; text &#20839;&#23481;</span><br></pre></td></tr></table></figure></p>
<p><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTeUE9zQlNPRktOQnM"></p>
<p>###發現前幾個檔案可以構成 .ELF 字樣，此為 linux elf 檔案的固定開頭形式，因此猜測可透過合併所有檔案來生成一個可執行檔</p>
<p>###透過下列指令可以合併兩個檔案:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat 0 1 &#62; test&#10;// &#23559; 0 &#21644; 1 &#30340;&#20839;&#23481;&#21512;&#20341;&#36664;&#20986;&#33267;&#26032;&#29983;&#25104;&#30340; test &#27284;&#26696;</span><br></pre></td></tr></table></figure></p>
<p>###由於檔案數量太多，因此透過 python 撰寫自動生成腳本</p>
<p>###<a href="https://drive.google.com/open?id=0BzGd3Qn1ZnTeMFlXQTdiaXVBQUU" target="_blank" rel="external">merge.py</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import os&#10;&#10;last = 6711&#10;&#10;for number in range(0, last):&#10;&#9;if number==0:&#10;&#9;&#9;print &#34;in &#34; + str(number)&#10;&#9;&#9;tmp = &#34;cat ../&#34; + str(number) + &#34; ../&#34; + str(number+1) + &#34; &#62; test1&#34;&#10;&#9;&#9;print &#34;test &#34; + str(number)&#10;&#9;&#9;os.system(tmp)&#10;&#9;else:&#10;&#9;&#9;print &#34;in &#34; + str(number)&#10;&#9;&#9;tmp = &#34;cat test&#34; + str(number) + &#34; ../&#34; + str(number+1) + &#34; &#62; test&#34; + str(number+1)&#10;&#9;&#9;print tmp&#10;&#9;&#9;print &#34;test &#34; + str(number)&#10;&#9;&#9;os.system(tmp)&#10;&#9;&#9;os.system(&#34;rm test&#34; + str(number))&#10;&#9;&#9;&#10;# os.system &#21487;&#20197;&#22519;&#34892; linux &#25351;&#20196;</span><br></pre></td></tr></table></figure>
<p>###組合生成單一檔案之後透過 hexedit 查看發現檔案開頭為 elf 的 magic number “7f 45 4c 46 02 01 …”，此為 elf 檔案的證據<br><img style="width: 700px;" src="https://googledrive.com/host/0BzGd3Qn1ZnTedkgyNHZGcW9odW8"></p>
<p>###或者也可以透過 file 指令觀察是否判定為 elf 檔案，加入執行權限之後執行之即可看到 flag</p>

            
                

            
        </div>
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">ETIQUETADO em</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/ctf-forensics/">ctf forensics</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/01/09/Return-to-libc/"  data-tooltip="Return to libc">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/11/24/可推清單/" data-tooltip="可推清單">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Mars Huang. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2016/01/09/Return-to-libc/"  data-tooltip="Return to libc">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/11/24/可推清單/" data-tooltip="可推清單">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-google-plus"></i><span class="">Share on Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=/2015/11/29/Wireshark-Package-Analysis/">
                <i class="fa fa-twitter"></i><span>Share on Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Mars Huang</h4>
        
            <h5 id="about-card-bio"><p>author.bio</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </h5>
        
        
    </div>
</div>

        <div id="cover" style="background-image:url('http://res.cloudinary.com/tranquilpeak-hexo-theme/image/upload/v1438975482/v1.3.0-cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->



</html>
